<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>IOC初始化流程 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="🍁IOC初始化我们知道，在Spring中，IOC的本质是容器对bean的管理，IoC容器的接口类是ApplicationContext，容器必须调用 refresh 才能正常工作 refresh源码1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545">
<meta property="og:type" content="article">
<meta property="og:title" content="IOC初始化流程">
<meta property="og:url" content="http://example.com/2023/07/23/IOC%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="🍁IOC初始化我们知道，在Spring中，IOC的本质是容器对bean的管理，IoC容器的接口类是ApplicationContext，容器必须调用 refresh 才能正常工作 refresh源码1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/57880/refresh.png">
<meta property="og:image" content="http://example.com/img/57880/refresh2.png">
<meta property="og:image" content="http://example.com/img/57880/refresh3.png">
<meta property="og:image" content="http://example.com/img/57880/refresh4.png">
<meta property="og:image" content="http://example.com/img/57880/refresh5.png">
<meta property="og:image" content="http://example.com/img/57880/refresh6.png">
<meta property="og:image" content="http://example.com/img/57880/refresh7.png">
<meta property="og:image" content="http://example.com/img/57880/refresh8.png">
<meta property="og:image" content="http://example.com/img/57880/refresh9.png">
<meta property="og:image" content="http://example.com/img/57880/refresh10.png">
<meta property="article:published_time" content="2023-07-23T02:56:50.000Z">
<meta property="article:modified_time" content="2023-07-24T05:13:50.000Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/57880/refresh.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-IOC初始化流程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/23/IOC%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2023-07-23T02:56:50.000Z" itemprop="datePublished">2023-07-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring/">Spring</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      IOC初始化流程
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="🍁IOC初始化"><a href="#🍁IOC初始化" class="headerlink" title="🍁IOC初始化"></a>🍁IOC初始化</h2><p>我们知道，在Spring中，IOC的本质是容器对bean的管理，IoC容器的接口类是ApplicationContext，容器必须调用 refresh 才能正常工作</p>
<h3 id="refresh源码"><a href="#refresh源码" class="headerlink" title="refresh源码"></a>refresh源码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">        <span class="type">StartupStep</span> <span class="variable">contextRefresh</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.refresh&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">        prepareRefresh();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">        <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">        prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">            postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="type">StartupStep</span> <span class="variable">beanPostProcess</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.beans.post-process&quot;</span>);</span><br><span class="line">            <span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">            invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">            registerBeanPostProcessors(beanFactory);</span><br><span class="line">            beanPostProcess.end();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize message source for this context.</span></span><br><span class="line">            initMessageSource();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">            initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">            onRefresh();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">            registerListeners();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">            finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">            finishRefresh();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">                logger.warn(<span class="string">&quot;Exception encountered during context initialization - &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;cancelling refresh attempt: &quot;</span> + ex);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">            destroyBeans();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Reset &#x27;active&#x27; flag.</span></span><br><span class="line">            cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Propagate exception to caller.</span></span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// Reset common introspection caches in Spring&#x27;s core, since we</span></span><br><span class="line">            <span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">            resetCommonCaches();</span><br><span class="line">            contextRefresh.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法总结"><a href="#方法总结" class="headerlink" title="方法总结"></a>方法总结</h3><p>refresh中主要会调12个方法</p>
<ol>
<li>prepareRefresh——做好准备工作</li>
<li>obtainFreshBeanFactory——创建或获取BeanFactory</li>
<li>prepareBeanFactory——准备BeanFactory</li>
<li>postProcessBeanFactory——子类扩展BeanFactory</li>
<li>invokeBeanFactoryPostProcessors ——后处理扩展BeanFactory</li>
<li>registerBeanPostProcessors——准备Bean后处理器</li>
<li>initMessageSource——为ApplicationContext提供国际化功能</li>
<li>initApplicationEventMulticaster——为ApplicationContext提供事件发布器</li>
<li>onRefresh——留给子类扩展</li>
<li>registerListeners——为ApplicationContext准备监听器</li>
<li>finishBeanFactoryInitialization——初始化单例Bean，执行Bean后处理器扩展</li>
<li>finishRefresh——准备生命周期管理器，发布ContextRefreshed事件</li>
</ol>
<p><strong>功能分类</strong></p>
<p> 【1】 为准备环境 </p>
<p> <strong>【2 3 4 5 6】 为准备 BeanFactory（重点）</strong> </p>
<p> 【7 8 9 10 12】 为准备 ApplicationContext </p>
<p> 【11】 为初始化 BeanFactory 中非延迟单例 bean</p>
<h2 id="🍁1-prepareRefresh"><a href="#🍁1-prepareRefresh" class="headerlink" title="🍁1. prepareRefresh"></a>🍁1. prepareRefresh</h2><blockquote>
<p>这一步创建和准备了 Environment 对象，它作为 ApplicationContext 的一个成员变量</p>
</blockquote>
<p>Environment 对象的作用之一是为后续 <strong>@Value</strong>，值注入时提供<strong>键值</strong> </p>
<p>Environment 分成三个主要部分</p>
<ul>
<li><ul>
<li>systemProperties - 保存 java 环境键值</li>
<li>systemEnvironment - 保存系统环境键值</li>
<li>自定义 PropertySource - 保存自定义键值，例如来自于 *.properties 文件的键值</li>
</ul>
</li>
</ul>
<img src="/img/57880/refresh.png" alt="img" style="zoom:67%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如何获得和解析 @Value 内容</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestEnvironment</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, IOException &#123;</span><br><span class="line">        <span class="comment">// 1) 获得 @Value 的值</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&gt; 仅获取 @Value 值&quot;</span>);</span><br><span class="line">        <span class="type">QualifierAnnotationAutowireCandidateResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QualifierAnnotationAutowireCandidateResolver</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> resolver.getSuggestedValue(<span class="keyword">new</span> <span class="title class_">DependencyDescriptor</span>(Bean1.class.getDeclaredField(<span class="string">&quot;name&quot;</span>), <span class="literal">false</span>));</span><br><span class="line">        System.out.println(name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2) 解析 @Value 的值</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&gt; 获取 @Value 值, 并解析$&#123;&#125;&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">javaHome</span> <span class="operator">=</span> resolver.getSuggestedValue(<span class="keyword">new</span> <span class="title class_">DependencyDescriptor</span>(Bean1.class.getDeclaredField(<span class="string">&quot;javaHome&quot;</span>), <span class="literal">false</span>));</span><br><span class="line">        System.out.println(javaHome);</span><br><span class="line">        System.out.println(getEnvironment().resolvePlaceholders(javaHome.toString()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3) 解析 SpEL 表达式</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&gt; 获取 @Value 值, 并解析#&#123;&#125;&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">expression</span> <span class="operator">=</span> resolver.getSuggestedValue(<span class="keyword">new</span> <span class="title class_">DependencyDescriptor</span>(Bean1.class.getDeclaredField(<span class="string">&quot;expression&quot;</span>), <span class="literal">false</span>));</span><br><span class="line">        System.out.println(expression);</span><br><span class="line">        <span class="type">String</span> <span class="variable">v1</span> <span class="operator">=</span> getEnvironment().resolvePlaceholders(expression.toString());</span><br><span class="line">        System.out.println(v1);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">StandardBeanExpressionResolver</span>().evaluate(v1, <span class="keyword">new</span> <span class="title class_">BeanExpressionContext</span>(<span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>(),<span class="literal">null</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Environment <span class="title function_">getEnvironment</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">StandardEnvironment</span> <span class="variable">env</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEnvironment</span>();</span><br><span class="line">        env.getPropertySources().addLast(<span class="keyword">new</span> <span class="title class_">ResourcePropertySource</span>(<span class="string">&quot;jdbc&quot;</span>, <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;jdbc.properties&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span> env;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line">        <span class="meta">@Value(&quot;hello&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String javaHome;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Value(&quot;#&#123;&#x27;class version:&#x27; + &#x27;$&#123;java.class.version&#125;&#x27;&#125;&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String expression;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="🍁2-obtainFreshBeanFactory"><a href="#🍁2-obtainFreshBeanFactory" class="headerlink" title="🍁2. obtainFreshBeanFactory"></a>🍁2. obtainFreshBeanFactory</h2><blockquote>
<p>这一步获取（或创建） BeanFactory，它也是作为 ApplicationContext 的一个成员变量</p>
</blockquote>
<p><strong>BeanFactory 的作用是负责 bean 的创建、依赖注入和初始化，bean 的各项特征由 BeanDefinition 定义</strong> </p>
<ul>
<li><ul>
<li>BeanDefinition 作为 bean 的设计蓝图，规定了 bean 的特征，如单例多例、依赖关系、初始销毁方法等</li>
<li>BeanDefinition 的来源有多种多样，可以是通过 xml 获得、配置类获得、组件扫描获得，也可以是编程添加</li>
</ul>
</li>
</ul>
<p>所有的 BeanDefinition 会存入 BeanFactory 中的 <strong>beanDefinitionMap</strong> 集合</p>
<img src="/img/57880/refresh2.png" alt="img" style="zoom:67%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 演示各种 BeanDefinition 的来源</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBeanDefinition</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; 一开始&quot;</span>);</span><br><span class="line">        <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames()));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; 1) 从 xml 获取 &quot;</span>);</span><br><span class="line">        <span class="type">XmlBeanDefinitionReader</span> <span class="variable">reader1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(beanFactory);</span><br><span class="line">        reader1.loadBeanDefinitions(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;bd.xml&quot;</span>));</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames())); </span><br><span class="line">        <span class="comment">//[bean1]</span></span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; 2) 从配置类获取 &quot;</span>);</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;config1&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Config1.class).getBeanDefinition());</span><br><span class="line">    	<span class="comment">// 识别处理bean</span></span><br><span class="line">        <span class="type">ConfigurationClassPostProcessor</span> <span class="variable">postProcessor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationClassPostProcessor</span>();</span><br><span class="line">        postProcessor.postProcessBeanDefinitionRegistry(beanFactory);</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames()));</span><br><span class="line">    	<span class="comment">//[bean1,config1,bean2]</span></span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; 3) 扫描获取 &quot;</span>);</span><br><span class="line">        <span class="type">ClassPathBeanDefinitionScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(beanFactory);</span><br><span class="line">        scanner.scan(<span class="string">&quot;day04.refresh.sub&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames()));</span><br><span class="line">        <span class="comment">//[bean1,config1,bean2,bean3,其他和包扫描相关的bean]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean2</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Config1</span> &#123;</span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> Bean2 <span class="title function_">bean2</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Bean2</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="🍁3-prepareBeanFactory"><a href="#🍁3-prepareBeanFactory" class="headerlink" title="🍁3. prepareBeanFactory"></a>🍁3. prepareBeanFactory</h2><blockquote>
<p>这一步会进一步<strong>完善 BeanFactory</strong>，为它的各项成员变量赋值</p>
</blockquote>
<p>beanExpressionResolver 用来解析 SpEL，常见实现为 StandardBeanExpressionResolver</p>
<p>propertyEditorRegistrars 会注册类型转换器 </p>
<ul>
<li><ul>
<li>它在这里使用了 ResourceEditorRegistrar 实现类</li>
<li>并应用 ApplicationContext 提供的 Environment 完成 ${ } 解析</li>
</ul>
</li>
</ul>
<p>registerResolvableDependency 来注册 beanFactory 以及 ApplicationContext，让它们也能用于依赖注入</p>
<p>beanPostProcessors 是 bean 后处理器集合，会工作在 bean 的生命周期各个阶段，此处会添加两个： </p>
<ul>
<li><ul>
<li>ApplicationContextAwareProcessor 用来解析 Aware 接口</li>
<li>ApplicationListenerDetector 用来识别容器中 ApplicationListener 类型的 bean</li>
</ul>
</li>
</ul>
<img src="/img/57880/refresh3.png" alt="img" style="zoom:67%;" />

<h2 id="🍁4-postProcessBeanFactory"><a href="#🍁4-postProcessBeanFactory" class="headerlink" title="🍁4. postProcessBeanFactory"></a>🍁4. postProcessBeanFactory</h2><blockquote>
<p>这一步是空实现，留给子类扩展</p>
</blockquote>
<p>一般 Web 环境的 ApplicationContext 都要利用它注册新的 Scope，完善 Web 下的 BeanFactory</p>
<p>这里体现的是<strong>模板方法</strong>设计模式</p>
<h2 id="🍁5-invokeBeanFactoryPostProcessors"><a href="#🍁5-invokeBeanFactoryPostProcessors" class="headerlink" title="🍁5. invokeBeanFactoryPostProcessors"></a>🍁5. invokeBeanFactoryPostProcessors</h2><blockquote>
<p>这一步会调用 beanFactory 后处理器</p>
</blockquote>
<p>beanFactory 后处理器，充当 beanFactory 的扩展点，可以用来<strong>补充或修改</strong> BeanDefinition</p>
<p>常见的 beanFactory 后处理器有 </p>
<ul>
<li><ul>
<li><strong>ConfigurationClassPostProcessor</strong> – 解析 @Configuration、@Bean、@Import、@PropertySource  等 </li>
<li>PropertySourcesPlaceHolderConfigurer – 替换 BeanDefinition 中的 ${ }</li>
<li>MapperScannerConfigurer – 补充 Mapper 接口对应的 BeanDefinition</li>
</ul>
</li>
</ul>
<img src="/img/57880/refresh4.png" alt="img" style="zoom:67%;" />

<h2 id="🍁6-registerBeanPostProcessors"><a href="#🍁6-registerBeanPostProcessors" class="headerlink" title="🍁6. registerBeanPostProcessors"></a>🍁6. registerBeanPostProcessors</h2><blockquote>
<p>这一步是继续从 beanFactory 中找出 bean 后处理器，添加至 beanPostProcessors 集合中</p>
</blockquote>
<p>bean 后处理器，充当 bean 的扩展点，可以工作在 bean 的实例化、依赖注入、初始化阶段，常见的有： </p>
<ul>
<li><ul>
<li><strong>Autowired</strong>AnnotationBeanPostProcessor 功能有：解析 <strong>@Autowired，@Value</strong>  注解 </li>
<li>CommonAnnotationBeanPostProcessor 功能有：解析 @Resource，@PostConstruct，@PreDestroy  </li>
<li>AnnotationAwareAspectJAutoProxyCreator 功能有：为符合<strong>切点的目标</strong> bean 自动创建代理</li>
</ul>
</li>
</ul>
<img src="/img/57880/refresh5.png" alt="img" style="zoom:67%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBeanPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> context.getDefaultListableBeanFactory();</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;bean1&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Bean1.class).getBeanDefinition());</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;bean2&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Bean2.class).getBeanDefinition());</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;bean3&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Bean3.class).getBeanDefinition());</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;aspect1&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Aspect1.class).getBeanDefinition());</span><br><span class="line">        <span class="comment">// 输出：foo(仅调用foo方法)</span></span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;processor1&quot;</span>,</span><br><span class="line">                                           BeanDefinitionBuilder.genericBeanDefinition(AutowiredAnnotationBeanPostProcessor.class).getBeanDefinition());</span><br><span class="line">        <span class="comment">// 多输出：&quot;发生了依赖注入...&quot; + bean2</span></span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;processor2&quot;</span>,</span><br><span class="line">                                           BeanDefinitionBuilder.genericBeanDefinition(CommonAnnotationBeanPostProcessor.class).getBeanDefinition());</span><br><span class="line">        <span class="comment">// 多输出：&quot;发生了依赖注入...&quot; + bean3</span></span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;processor3&quot;</span>,</span><br><span class="line">                                           BeanDefinitionBuilder.genericBeanDefinition(AnnotationAwareAspectJAutoProxyCreator.class).getBeanDefinition());</span><br><span class="line">    	<span class="comment">// 在foo前多输出：before...</span></span><br><span class="line">        context.refresh();</span><br><span class="line">        beanFactory.getBean(Bean1.class).foo();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line">        Bean2 bean2;</span><br><span class="line">        Bean3 bean3;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Autowired</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBean2</span><span class="params">(Bean2 bean2)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;发生了依赖注入...&quot;</span> + bean2);</span><br><span class="line">            <span class="built_in">this</span>.bean2 = bean2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Resource</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBean3</span><span class="params">(Bean3 bean3)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;发生了依赖注入...&quot;</span> + bean3);</span><br><span class="line">            <span class="built_in">this</span>.bean3 = bean3;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean2</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean3</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Aspect</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Aspect1</span> &#123;</span><br><span class="line">            <span class="meta">@Before(&quot;execution(* foo())&quot;)</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;before...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="🍁7-initMessageSource"><a href="#🍁7-initMessageSource" class="headerlink" title="🍁7. initMessageSource"></a>🍁7. initMessageSource</h2><blockquote>
<p>这一步是为 ApplicationContext 添加 messageSource 成员，实现<strong>国际化</strong>功能</p>
</blockquote>
<p>去 beanFactory 内找名为 messageSource 的 bean，如果没有，则提供空的 MessageSource 实现</p>
<img src="/img/57880/refresh6.png" alt="img" style="zoom:67%;" />

<h2 id="🍁8-initApplicationContextEventMulticaster"><a href="#🍁8-initApplicationContextEventMulticaster" class="headerlink" title="🍁8. initApplicationContextEventMulticaster"></a>🍁8. initApplicationContextEventMulticaster</h2><blockquote>
<p>这一步为 ApplicationContext 添加<strong>事件广播器</strong>成员，即 applicationContextEventMulticaster，它的作用是发布事件给监听器</p>
</blockquote>
<p>去 beanFactory 找名为 applicationEventMulticaster 的 bean 作为事件广播器，若没有，会创建默认的事件广播器</p>
<p>之后就可以调用 ApplicationContext.publishEvent(事件对象) 来发布事件</p>
<img src="/img/57880/refresh7.png" alt="img" style="zoom:67%;" />

<h2 id="🍁9-onRefresh"><a href="#🍁9-onRefresh" class="headerlink" title="🍁9. onRefresh"></a>🍁9. onRefresh</h2><blockquote>
<p>这一步是空实现，留给子类扩展</p>
</blockquote>
<p>SpringBoot 中的子类在这里准备了 WebServer，即内嵌 web 容器(Tomcat)</p>
<p>体现的是模板方法设计模式</p>
<h2 id="🍁10-registerListeners"><a href="#🍁10-registerListeners" class="headerlink" title="🍁10. registerListeners"></a>🍁10. registerListeners</h2><blockquote>
<p>这一步会从多种途径找到事件监听器，并添加至 applicationEventMulticaster</p>
</blockquote>
<p>事件监听器顾名思义，用来接收事件广播器发布的事件，有如下来源 </p>
<ul>
<li><ul>
<li>事先编程添加的</li>
<li>来自容器中的 bean</li>
<li>来自于 @EventListener  的解析</li>
</ul>
</li>
</ul>
<p>要实现事件监听器，只需要实现 ApplicationListener 接口，重写其中 onApplicationEvent(E e) 方法即可</p>
<img src="/img/57880/refresh8.png" alt="img" style="zoom:67%;" />

<h2 id="🍁11-finishBeanFactoryInitialization"><a href="#🍁11-finishBeanFactoryInitialization" class="headerlink" title="🍁11. finishBeanFactoryInitialization"></a>🍁11. finishBeanFactoryInitialization</h2><blockquote>
<p>这一步会将 beanFactory 的成员补充完毕，并初始化所有非延迟单例 bean</p>
</blockquote>
<p>conversionService 也是一套转换机制，作为对 PropertyEditor 的补充</p>
<p>embeddedValueResolvers 即<strong>内嵌值</strong>解析器，用来解析 @Value  中的 ${ }，借用的是 Environment 的功能 </p>
<p>singletonObjects 即单例池，缓存所有单例对象 </p>
<ul>
<li><ul>
<li>对象的创建都分三个阶段，每一阶段都有不同的 bean 后处理器参与进来，扩展功能</li>
</ul>
</li>
</ul>
<img src="/img/57880/refresh9.png" alt="img" style="zoom:67%;" />

<h2 id="🍁12-finishRefresh"><a href="#🍁12-finishRefresh" class="headerlink" title="🍁12. finishRefresh"></a>🍁12. finishRefresh</h2><blockquote>
<p>这一步会为 ApplicationContext 添加 lifecycleProcessor 成员，用来控制容器内<strong>需要生命周期管理</strong>的 bean</p>
</blockquote>
<p>如果容器中有名称为 lifecycleProcessor 的 bean 就用它，否则创建默认的生命周期管理器</p>
<p>准备好生命周期管理器，就可以实现 </p>
<ul>
<li><ul>
<li>调用 context 的 start，即可触发所有实现 LifeCycle 接口 bean 的 start</li>
<li>调用 context 的 stop，即可触发所有实现 LifeCycle 接口 bean 的 stop</li>
</ul>
</li>
</ul>
<p>发布 ContextRefreshed 事件，整个 refresh 执行完成</p>
<img src="/img/57880/refresh10.png" alt="img" style="zoom:67%;" />

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/07/23/IOC%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B/" data-id="clq4m8c270017bc5sd706exsk" data-title="IOC初始化流程" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/07/24/bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          bean的生命周期
        
      </div>
    </a>
  
  
    <a href="/2023/07/22/Spring%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Spring循环依赖</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">Java基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%B9%B6%E5%8F%91/">Java并发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E5%9F%BA%E7%A1%80/" rel="tag">Java基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E5%B9%B6%E5%8F%91/" rel="tag">Java并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringMVC/" rel="tag">SpringMVC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JVM/" style="font-size: 13.33px;">JVM</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 16.67px;">Java基础</a> <a href="/tags/Java%E5%B9%B6%E5%8F%91/" style="font-size: 20px;">Java并发</a> <a href="/tags/MySQL/" style="font-size: 16.67px;">MySQL</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Spring/" style="font-size: 18.33px;">Spring</a> <a href="/tags/SpringBoot/" style="font-size: 11.67px;">SpringBoot</a> <a href="/tags/SpringMVC/" style="font-size: 11.67px;">SpringMVC</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">分布式</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 15px;">数据结构</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 11.67px;">算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/12/14/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2023/12/05/JUC%E5%B7%A5%E5%85%B7/">JUC工具</a>
          </li>
        
          <li>
            <a href="/2023/11/10/JUC%E6%97%A0%E9%94%81/">JUC无锁</a>
          </li>
        
          <li>
            <a href="/2023/11/06/ReentrantLock/">ReentrantLock</a>
          </li>
        
          <li>
            <a href="/2023/10/23/SpringCloud%E6%80%BB%E8%A7%88/">SpringCloud总览</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>